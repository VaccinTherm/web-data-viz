<!DOCTYPE html>

<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="../js/sessao.js">

    <!-- link do rostinho -->

    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet" />

    <title>Dashboard</title>

    <link rel="stylesheet" href="./assets/css/dash.css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="cabecalho">
        <div class="home">
            <a href="../index.html"><img src="assets/img/home.png" alt="Home" /></a>
        </div>

        <div class="usuarios"><img src="assets/img/users.png" /></div>

        <a href="../dashboard/veiculos.html" id="veiculos" class="veiculos">
            <img src="assets/img/cars.png" />
        </a>

        <div class="logo"><img src="assets/img/logo.png" /></div>
    </div>

    <div class="telaVeiculos">
        <div>
            <div class="perfil2">
                <div class="imgPerfil"><img src="assets/img/perfil.png" /></div>

                <div class="arroba">@rayane</div>

                <div class="nome">Rayane G.</div>

                <div class="linhaSegTela2"></div>
            </div>

            <div class="metricasSegTela">
                <p class="tituloSegTela">Métricas Atuais</p>

                <div class="linhaSegTela"></div>

                <p class="veiculosSegTela">Veículos: 5</p>
            </div>
        </div>

        <div class="vizualizacaoVeiculos" id="listaVeiculos">
            <div class="caminhoes">
                <div><img class="imgCam" src="assets/img/caminhao.png" /></div>

                <a href="../dashboard/dash.html" class="veiculo">Veículo 1</a>

                <div class="situacao"></div>

                <p class="texto">Boa</p>

                <div class="vacina">Coronavac</div>

                <div><img src="assets/img/mais.png" /></div>
            </div>

            <div class="caminhoes">
                <div><img class="imgCam" src="assets/img/caminhao.png" /></div>

                <a href="../dashboard/dash.html" class="veiculo">Veículo 2</a>

                <div class="situacao situacao2"></div>

                <p class="texto">Alerta</p>

                <div class="vacina">Coronavac</div>

                <div><img src="assets/img/mais.png" /></div>
            </div>

            <div class="caminhoes">
                <div><img class="imgCam" src="assets/img/caminhao.png" /></div>

                <a href="../dashboard/dash.html" class="veiculo">Veículo 3</a>

                <div class="situacao situacao3"></div>

                <p class="texto">Crítico</p>

                <div class="vacina">Coronavac</div>

                <div><img src="assets/img/mais.png" /></div>
            </div>

            <div class="caminhoes">
                <div><img class="imgCam" src="assets/img/caminhao.png" /></div>

                <a href="../dashboard/dash.html" class="veiculo">Veículo 4</a>

                <div class="situacao situacao4"></div>

                <p class="texto">Alerta</p>

                <div class="vacina">Coronavac</div>

                <div><img src="assets/img/mais.png" /></div>
            </div>

            <div class="caminhoes">
                <div><img class="imgCam" src="assets/img/caminhao.png" /></div>

                <a href="../dashboard/dash.html" class="veiculo">Veículo 5</a>

                <div class="situacao"></div>

                <p class="texto">Boa</p>

                <div class="vacina">Coronavac</div>

                <div><img src="assets/img/mais.png" /></div>
            </div>
        </div>

        <div class="KPIs">
            <div class="box box-1">
                <p class="text">Total de Veículos</p>

                <p class="text">200</p>
            </div>

            <div class="box box-2">
                <p class="text">Veículos Bons</p>

                <p class="text">170</p>
            </div>

            <div class="box box-3">
                <p class="text">Veículos em Alerta</p>

                <p class="text">20</p>
            </div>

            <div class="box box-4">
                <p class="text">Veículos Críticos</p>

                <p class="text">10</p>
            </div>
        </div>
    </div>

    <script data-jsd-embedded data-key="24541678-4771-47a1-9087-0d5fee5b6600"
        data-base-url="https://jsd-widget.atlassian.com"
        src="https://jsd-widget.atlassian.com/assets/embed.js"></script>
    <script>
        const idEmpresa = sessionStorage.ID_EMPRESA;
        console.log(idEmpresa);

        function buscarVeiculosPorEmpresa(idEmpresa) {
            return fetch(`/empresas/buscar-veiculos-por-empresa/${idEmpresa}`, {
                cache: "no-store",
            })
                .then(function (response) {
                    if (response.ok) {
                        return response.json();
                    } else {
                        console.error("Nenhum dado encontrado ou erro na API");
                        return Promise.reject("Erro na API");
                    }
                })
                .then(function (veiculos) {
                    for (let i = 0; i < veiculos.length; i++) {
                        const veiculo = veiculos[i];    
                        console.log(veiculo);
                        listaVeiculos.innerHTML = `
                            <div class="caminhoes">
                                <div><img class="imgCam" src="assets/img/caminhao.png" /></div>
                                <a href="../dashboard/dash.html" class="veiculo">Veículo ${veiculo.idVeiculo}</a>
                                <p class="texto">${veiculo.modeloVeiculo}</p>
                                <div class="situacao"></div>
                                <p class="texto">Boa</p>
                                <p class="texto">${veiculo.responsavel}</p>
                                <p class="texto">${veiculo.placa}</p>
                                <div class="vacina">Coronavac</div>
                                <div><img src="assets/img/mais.png" /></div>
                            </div>`;
                    }
                })
                .catch(function (error) {
                    console.error(
                        `Erro na obtenção dos dados p/ gráfico: ${error.message}`
                    );
                });
        }

        buscarVeiculosPorEmpresa(idEmpresa);
    </script>
</body>

</html>